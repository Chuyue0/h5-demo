<!DOCTYPE html>
<html>

<head>
    <title>素材加载</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.bootcss.com/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="./css/dog.css">
    <style type="text/css">
    body,
    html {
        height: 100%;
        -webkit-tap-highlight-color: transparent;
        max-width: 640px;
        max-height: 1136px;
        margin: auto;
    }
    
    .hide {
        display: none;
    }
    
    .loading,
    .container {
        width: 100%;
        height: 100%;
        left: 0%;
        top: 0%;
        margin: 0;
        border-radius: 0px;
        position: relative;
        /*background-color: rgba(0, 0, 0, 0.5);*/
    }
    
    .loading .center {
        width: 80%;
        height: 30%;
        text-align: center;
        position: absolute;
        left: 10%;
        top: 35%;
    }
    
    .loading p {
        width: 80%;
        text-align: center;
        position: absolute;
        left: 10%;
        top: 70%;
        /*color: white;*/
    }
    
    .loading img {
        width: 40%;
        text-align: center;
        position: absolute;
        left: 30%;
        top: 5%;
        /*color: white;*/
    }
    
    .husky {
        top: 30%;
        left: 8%
    }
    
    img {
        width: 100%
    }
    </style>
</head>

<body style="">
    <div class="loading">
        <p>素材加载中，请稍后</p>
        <img style="position: absolute;" width="100%" src="./img/timg.gif">
        <div class="husky">
            <div class="mane">
                <div class="coat"></div>
            </div>
            <div class="body">
                <div class="head">
                    <div class="ear"></div>
                    <div class="ear"></div>
                    <div class="face">
                        <div class="eye"></div>
                        <div class="eye"></div>
                        <div class="nose"></div>
                        <div class="mouth">
                            <div class="lips"></div>
                            <div class="tongue"></div>
                        </div>
                    </div>
                </div>
                <div class="torso"></div>
            </div>
            <div class="legs">
                <div class="front-legs">
                    <div class="leg"></div>
                    <div class="leg"></div>
                </div>
                <div class="hind-leg">
                </div>
            </div>
            <div class="tail">
                <div class="tail">
                    <div class="tail">
                        <div class="tail">
                            <div class="tail">
                                <div class="tail">
                                    <div class="tail"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 狗狗的身体 -->
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display:none">
            <defs>
                <filter id="squiggly-0">
                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="0" />
                    <feDisplacementMap id="displacement" in="SourceGraphic" in2="noise" scale="2" />
                </filter>
                <filter id="squiggly-1">
                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="1" />
                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
                </filter>
                <filter id="squiggly-2">
                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="2" />
                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" />
                </filter>
                <filter id="squiggly-3">
                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="3" />
                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
                </filter>
                <filter id="squiggly-4">
                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="4" />
                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="1" />
                </filter>
            </defs>
        </svg>
    </div>
    <div class="container hide">
        <!-- <img class="deferred" src="./img/1.jpg" alt="">
        <img class="deferred" src="./img/2.jpg" alt="">
        <img class="deferred" src="./img/3.jpg" alt="">
        <img class="deferred" src="./img/4.jpg" alt="">
        <img class="deferred" src="./img/5.jpg" alt="">
        <img class="deferred" src="./img/6.jpg" alt="">
        <img class="deferred" src="./img/7.jpg" alt="">
        <img class="deferred" src="./img/8.jpg" alt="">
        <img class="deferred" src="./img/9.jpg" alt="">
        <img class="deferred" src="./img/10.jpg" alt="">
        <img class="deferred" src="./img/11.jpg" alt=""> -->
    </div>
    <!-- 在没有manifest的情况下，可以hide预先加载不显示的图片，后面再赋值 -->
    <!-- <img class="deferred hide" src="./img/12.jpg" alt=""> -->
    <script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/PreloadJS/0.6.0/preloadjs.min.js"></script>
    <script src="http://cdn.bootcss.com/SoundJS/0.6.0/soundjs.min.js"></script>
    <script>
    //可视区居中显示
    var window_height = $(window).height();
    if (window_height > 1136) {
        var temp_top = ($(window).height() - 1136) / 2;
        $('body').css('margin-top', temp_top);
    }

    //建议使用资源清单，方便管理，如果资源较多，可以考虑独立出json文件，脚本自动生成。
    var manifest = [
        "./img/1.jpg",
        "./img/2.jpg",
        "./img/3.jpg",
        "./img/4.jpg",
        "./img/5.jpg",
        "./img/6.jpg",
        "./img/7.jpg",
        "./img/8.jpg",
        "./img/9.jpg",
        "./img/10.jpg",
        "./img/11.jpg",
        "./img/12.jpg", {
            id: '告白气球',
            src: './audio/107192078.m4a'
        }, {
            id: '一生有你',
            src: './audio/95484.m4a'
        },
    ]

    //PreloadJS加载代码
    var loading_deferred = $.Deferred();
    $.when(loading_deferred).done(function() {
        $('.container').removeClass('hide');
        // 淡入淡出效果
        $('.container').addClass('fadeIn animated');
        $('.loading').addClass('fadeOut animated');
    });
    var queue = new createjs.LoadQueue();
    //SoundJS默认用的是复杂的Web Audio接口，这会导致加载音频变慢，所以显示注册使用html的audio即可
    createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);
    //如果需要加载音频，需要注册SoundJs插件
    queue.installPlugin(createjs.Sound);
    queue.on("complete", function() {
        var items = queue.getItems();
        for (var i = 0; i < items.length; i++) {
            $('.container').append(items[i].result);
        };

        loading_deferred.resolve();
        queue.getLoadedItems();
        createjs.Sound.play("告白气球");
    }, this);
    queue.on("progress", function(event) {
        //console.log("Progress:", queue.progress, event.progress);
        var persent = Math.floor(queue.progress * 100) + "%";
        $('.loading p').text('素材加载中（' + persent + '）');
    });
    //设置并列加载，否则每次只加载一个，太耗时
    queue.setMaxConnections(5);
    queue.maintainScriptOrder = true;
    queue.loadManifest(manifest);


    //简单的图片素材加载代码
    // var loading_deferred = $.Deferred();
    // var loading_index = 0;
    // var loading_length = $('.deferred').length;
    // // var loading_length = manifest.img.length;
    // $.when(loading_deferred).done(function() {
    //     $('.container').removeClass('hide');
    //     // 淡入淡出效果
    //     $('.container').addClass('fadeIn animated');
    //     $('.loading').addClass('fadeOut animated');
    // });
    // if (loading_length > 0) {
    //     for (var i = 0; i < loading_length; i++) {
    //         var temp_src = $('.deferred').get(i).src;
    //         // var temp_src = manifest.img[i];
    //         var temp_img = new Image;
    //         temp_img.onload = function() {
    //             loading_index++;
    //             //console.log(loading_index);
    //             $('.loading p').text('素材加载中（' + loading_index + '/' + loading_length + '）');
    //             var persent = (loading_index / loading_length) * 100 + "%";
    //             if (loading_index == loading_length) {
    //                 loading_deferred.resolve();
    //             }
    //         };
    //         temp_img.onerror = function() {
    //             $('.loading p').text('素材加载失败！');
    //         }
    //         temp_img.src = temp_src;
    //     }
    // } else {
    //     loading_deferred.resolve();
    // }
    </script>
</body>

</html>
